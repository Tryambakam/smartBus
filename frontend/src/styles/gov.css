@import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap");

/* ================================
   Design Tokens
   ================================ */

html, body, #root {
  height: 100%;
  width: 100%;
}

#root{
  max-width: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

:root{
  --bg: #f6f7f9;
  --surface: #ffffff;
  --surface-2: #fbfcfe;
  --border: #e5e7eb;
  --text: #111827;
  --muted: #6b7280;

  --primary: #0b4ea2;
  --primary-2: #083a79;
  --accent: #ff9f1c;

  --success: #16a34a;
  --danger: #b91c1c;
  --warn: #f59e0b;
  --info: #2563eb;

  --radius: 14px;
  --radius-lg: 18px;

  --shadow-soft: 0 4px 16px rgba(17,24,39,0.08);
  --shadow: 0 14px 36px rgba(17,24,39,0.14);

  --font: "Inter",
    -apple-system, BlinkMacSystemFont,
    "SF Pro Text", "SF Pro Display",
    "Segoe UI", Roboto, "Noto Sans",
    Arial, sans-serif;

  --ease: cubic-bezier(.2,.8,.2,1);
  --t-fast: 160ms;
  --t-med: 240ms;
}

/* Dark mode */
:root[data-theme="dark"]{
  --bg: #0b1220;
  --surface: #0f172a;
  --surface-2: #0b1326;
  --border: rgba(148,163,184,0.18);
  --text: #e5e7eb;
  --muted: rgba(226,232,240,0.7);

  --primary: #1d4ed8;
  --primary-2: #1e40af;
  --accent: #ffb020;

  --shadow-soft: 0 6px 18px rgba(0,0,0,0.35);
  --shadow: 0 16px 40px rgba(0,0,0,0.45);
}

/* ================================
   Global base
================================ */
*{ box-sizing: border-box; }
html, body, #root { height: 100%; }

body{
  margin: 0;
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

a{ color: var(--primary); text-decoration: none; }
a:hover{ text-decoration: underline; }

html, body, .gov-shell, .card{
  transition:
    background-color var(--t-med) var(--ease),
    color var(--t-med) var(--ease),
    border-color var(--t-med) var(--ease),
    box-shadow var(--t-med) var(--ease);
}

/* Slightly tone map in dark mode */
:root[data-theme="dark"] .leaflet-container{
  filter: saturate(0.95) contrast(0.95) brightness(0.92);
}

/* ================================
   Shell Layout
   IMPORTANT: your pages must be:
   <div className="gov-shell"> ... <main className="gov-main">...</main>
================================ */
.gov-shell{
  height: 100vh;
  min-height: 0;
  display: grid;
  grid-template-rows: auto auto auto 1fr; /* header + banner + alerts + main */
}

/* ================================
   Header
================================ */
.gov-header{
  background: linear-gradient(90deg, var(--primary), var(--primary-2));
  color: #fff;
  padding: 10px 16px;
  border-bottom: 3px solid var(--accent);
}

.gov-header-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 14px;
}

.gov-brand{
  display:flex;
  align-items:center;
  gap: 12px;
  min-width: 260px;
}

.gov-logo{
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.18);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  flex: 0 0 auto;
}

.gov-title{ line-height: 1.12; }
.gov-title .dept{
  font-weight: 900;
  font-size: 14px;
  letter-spacing: 0.2px;
}
.gov-title .app{
  font-size: 12px;
  opacity: 0.92;
  font-weight: 600;
}

.gov-right{
  display:flex;
  align-items:center;
  gap: 12px;
}

.gov-pills{
  display:flex;
  align-items:center;
  gap: 10px;
  flex-wrap: wrap;
  justify-content:flex-end;
}

.pill{
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.18);
  white-space: nowrap;
  font-size: 12px;
  display:flex;
  align-items:center;
  gap: 8px;
  backdrop-filter: blur(6px);
}

.pill.ok{
  background: rgba(22,163,74,0.20);
  border-color: rgba(22,163,74,0.35);
}
.pill.bad{
  background: rgba(185,28,28,0.20);
  border-color: rgba(185,28,28,0.35);
}

.status-dot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--success);
  box-shadow: 0 0 0 4px rgba(34,197,94,0.18);
  animation: pulse 1.8s var(--ease) infinite;
}
.pill.bad .status-dot{
  background: #ef4444;
  box-shadow: 0 0 0 4px rgba(239,68,68,0.18);
}

.gov-actions{
  display:flex;
  align-items:center;
  gap: 10px;
  padding-left: 10px;
  border-left: 1px solid rgba(255,255,255,0.18);
}

.icon-btn,
.theme-btn{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.18);
  color: #fff;
  cursor:pointer;
  font-size: 12px;
  font-weight: 800;
  user-select:none;
  transition: transform var(--t-fast) var(--ease), background var(--t-fast) var(--ease);
}
.icon-btn:hover,
.theme-btn:hover{
  background: rgba(255,255,255,0.18);
  transform: translateY(-1px);
}
.icon-btn:active,
.theme-btn:active{
  transform: translateY(0px);
}

@media (max-width: 760px){
  .gov-title .app{ display:none; }
  .gov-actions{ border-left: none; padding-left: 0; }
  .gov-header-row{
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .gov-right{
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
  }

  .gov-pills{
    width: 100%;
    justify-content: flex-start;
    flex-wrap: wrap;
  }
}

/* ================================
   Banner
================================ */
.gov-banner{
  background: #eef2ff;
  border-bottom: 1px solid #c7d2fe;
  padding: 8px 16px;
  font-size: 12px;
  color: #1e3a8a;
}
:root[data-theme="dark"] .gov-banner{
  background: rgba(30,41,59,0.70);
  border-bottom: 1px solid rgba(148,163,184,0.18);
  color: rgba(226,232,240,0.9);
}

/* ================================
   Alerts Row (compact, never giant)
   Put alerts OUTSIDE gov-main (between banner and main)
================================ */
.alerts{
  padding: 10px 14px;
  display: flex;
  gap: 10px;
  align-items: center;
  overflow-x: auto;
  overflow-y: hidden;
  white-space: nowrap;
}
.alerts::-webkit-scrollbar{ height: 8px; }
.alerts::-webkit-scrollbar-thumb{
  background: rgba(148,163,184,0.35);
  border-radius: 999px;
}

.alert{
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  gap: 8px;

  padding: 10px 12px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.35;

  border: 1px solid var(--border);
  background: var(--surface);
  box-shadow: var(--shadow-soft);
  max-width: 820px;
}
.alert b{ font-weight: 900; }
.alert span{
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.alert.info{ border-color: rgba(37,99,235,0.28); background: rgba(37,99,235,0.08); }
.alert.warn{ border-color: rgba(245,158,11,0.30); background: rgba(245,158,11,0.10); }
.alert.danger{ border-color: rgba(185,28,28,0.30); background: rgba(185,28,28,0.10); }

/* ================================
   Main Grid (Dashboard)
   KEY FIX: main is 1fr so it fills remaining height
================================ */
.gov-main{
  min-height: 0;
  overflow: hidden;
  min-height: 0;
  display: grid;
  grid-template-columns: 340px 1fr 360px;
  gap: 12px;
  padding: 12px;
}

/* Panels must be flex columns to allow internal scrolling */
.left-panel, .map-card, .right-panel{
  min-height: 0;
  height: auto;
  display: flex;
  flex-direction: column;
}

/* Only body content scrolls inside panels */
.left-panel .card-b,
.right-panel .card-b{
  min-height: 0;
  overflow: auto;
}

/* ================================
   Cards / Elements
================================ */
.card{
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-soft);
  transition: transform var(--t-med) var(--ease), box-shadow var(--t-med) var(--ease);
}
.card:hover{
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.card-h{
  padding: 12px 12px 10px 12px;
  border-bottom: 1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  background: linear-gradient(180deg, var(--surface-2), transparent);
  border-top-left-radius: var(--radius-lg);
  border-top-right-radius: var(--radius-lg);
}

.card-h .h{
  font-weight: 900;
  font-size: 12px;
  letter-spacing: 0.6px;
  text-transform: uppercase;
}
.card-b{ padding: 12px; }

.label{
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 6px;
  font-weight: 700;
}

.select, .btn, .input{
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
  font-size: 14px;
  transition: box-shadow var(--t-fast) var(--ease), border-color var(--t-fast) var(--ease);
}

:root[data-theme="dark"] .select,
:root[data-theme="dark"] .btn,
:root[data-theme="dark"] .input{
  background: rgba(15,23,42,0.65);
  color: var(--text);
}

.btn{
  background: var(--primary);
  border-color: var(--primary);
  color: #fff;
  font-weight: 900;
  cursor: pointer;
  transition: transform var(--t-fast) var(--ease), background var(--t-fast) var(--ease);
}
.btn:hover{ background: var(--primary-2); transform: translateY(-1px); }
.btn:active{ transform: translateY(0px); }

.row{ display:flex; gap: 10px; }
.row > *{ flex: 1; }

.muted{ color: var(--muted); font-size: 12px; font-weight: 600; }
.divider{ height: 1px; background: var(--border); margin: 12px 0; }

/* List items */
.list{
  display:flex;
  flex-direction:column;
  gap: 10px;
}

.item{
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px;
  display:flex;
  justify-content:space-between;
  gap: 10px;
  background: var(--surface);
  transition: border-color var(--t-fast) var(--ease), transform var(--t-fast) var(--ease);
}
.item:hover{
  border-color: rgba(148,163,184,0.55);
  transform: translateY(-1px);
}
.item b{ font-size: 13px; font-weight: 900; }
.kv{ font-size: 12px; color: var(--muted); font-weight: 600; }

/* Focus */
select:focus, button:focus, input:focus{
  outline: none;
  box-shadow: 0 0 0 3px rgba(11,78,162,0.15);
  border-color: rgba(11,78,162,0.45);
}

/* ================================
   Map Card (MOST IMPORTANT FIX)
================================ */
.map-card{
  overflow: hidden;
  min-height: 55vh;
}

.map-wrap{
  flex: 1;
  min-height: 0;
}

.map-wrap .leaflet-container{
  height: 100% !important;
  width: 100% !important;
}

/* Leaflet zoom control polish */
.leaflet-control-zoom{
  box-shadow: var(--shadow-soft);
  border-radius: 10px;
  overflow: hidden;
}

/* ================================
   Animations (bus + skeleton)
================================ */
@keyframes pulse{
  0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.45); }
  70% { box-shadow: 0 0 0 10px rgba(34,197,94,0); }
  100% { box-shadow: 0 0 0 0 rgba(34,197,94,0); }
}

/* Animated Bus Marker */
.bus-marker-icon{
  background: transparent !important;
  border: none !important;
}
.bus-marker-wrap{
  width: 34px;
  height: 34px;
  position: relative;
  display: grid;
  place-items: center;
}
.bus-marker-emoji{
  font-size: 20px;
  z-index: 2;
  animation: busFloat 2.6s var(--ease) infinite;
  filter: drop-shadow(0 8px 14px rgba(17,24,39,0.25));
}
.bus-marker-pulse{
  position: absolute;
  inset: 6px;
  border-radius: 999px;
  background: rgba(11,78,162,0.15);
  border: 1px solid rgba(11,78,162,0.25);
  animation: busPulse 2.0s var(--ease) infinite;
  z-index: 1;
}
@keyframes busFloat{
  0%{ transform: translateY(0); }
  50%{ transform: translateY(-4px); }
  100%{ transform: translateY(0); }
}
@keyframes busPulse{
  0%{ transform: scale(0.92); opacity: 0.55; }
  70%{ transform: scale(1.38); opacity: 0; }
  100%{ transform: scale(1.38); opacity: 0; }
}

/* Skeleton (premium shimmer) */
.skel{
  background: linear-gradient(90deg, rgba(229,231,235,1) 25%, rgba(243,244,246,1) 37%, rgba(229,231,235,1) 63%);
  background-size: 400% 100%;
  animation: skelShimmer 1.5s var(--ease) infinite;
  border-radius: 10px;
}
:root[data-theme="dark"] .skel{
  background: linear-gradient(90deg, rgba(30,41,59,0.65) 25%, rgba(51,65,85,0.55) 37%, rgba(30,41,59,0.65) 63%);
}
@keyframes skelShimmer{
  0%{ background-position: 100% 0; }
  100%{ background-position: -100% 0; }
}
.skel-line{ height: 12px; margin: 8px 0; }
.skel-line.sm{ width: 45%; }
.skel-line.md{ width: 70%; }
.skel-line.lg{ width: 92%; }

.skel-card{
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px;
  background: var(--surface);
}

/* ================================
   ETA Timeline
================================ */
.eta-timeline{
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.eta-item{
  display: grid;
  grid-template-columns: 22px 1fr;
  gap: 10px;
  padding: 10px;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: var(--surface);
  animation: fadeUp 420ms var(--ease) both;
}
@keyframes fadeUp{
  from{ opacity: 0; transform: translateY(6px); }
  to{ opacity: 1; transform: translateY(0); }
}

.eta-left{
  position: relative;
  display: flex;
  justify-content: center;
}

.eta-dot{
  width: 12px;
  height: 12px;
  border-radius: 999px;
  margin-top: 4px;
  background: rgba(11,78,162,0.20);
  border: 2px solid rgba(11,78,162,0.35);
}
.eta-dot.active{
  background: rgba(11,78,162,0.95);
  border-color: rgba(11,78,162,0.95);
  box-shadow: 0 0 0 6px rgba(11,78,162,0.12);
}

.eta-line{
  position: absolute;
  top: 20px;
  bottom: -8px;
  width: 2px;
  background: rgba(229,231,235,1);
}
:root[data-theme="dark"] .eta-line{
  background: rgba(148,163,184,0.25);
}

.eta-content{ display:flex; flex-direction:column; gap: 6px; }

.eta-top{ display:flex; justify-content:space-between; gap: 12px; }
.eta-stop{ font-weight: 900; font-size: 14px; }

.eta-badge{
  min-width: 82px;
  text-align: center;
  padding: 8px 10px;
  border-radius: 999px;
  background: rgba(15,118,110,0.12);
  border: 1px solid rgba(15,118,110,0.22);
  color: rgba(15,118,110,1);
  font-weight: 900;
  font-size: 12px;
  white-space: nowrap;
}
:root[data-theme="dark"] .eta-badge{
  background: rgba(34,197,94,0.10);
  border-color: rgba(34,197,94,0.22);
  color: rgba(187,247,208,0.95);
}

.eta-sub{ font-size: 12px; color: var(--muted); font-weight: 600; }

/* ================================
   Login Page Helpers
   Use: <main className="gov-main login-main"> ...
================================ */
.login-main{
  grid-template-columns: 1fr !important;
  place-items: center;
  padding: 28px 16px !important;
}
.login-main .card{
  width: 100%;
  max-width: 480px;
}
.login-main .card-b{
  overflow: visible;
}

/* ================================
   Responsive
================================ */
@media (max-width: 1200px){
  .gov-main{ grid-template-columns: 320px 1fr; }
  .right-panel{ display:none; }
}

@media (max-width: 820px){
  .gov-shell{ height: auto; min-height: 100vh; }
  .gov-main{
    grid-template-columns: 1fr;
    overflow: visible;
  }
  .map-card{ height: 60vh; }
}

/* ================================
   Reduced motion
================================ */
@media (prefers-reduced-motion: reduce){
  *{ animation-duration: 1ms !important; animation-iteration-count: 1 !important; transition-duration: 1ms !important; }
}
